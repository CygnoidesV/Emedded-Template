<!-- HTML header for doxygen 1.9.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>电控组文档: 代码规范</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">电控组文档<span id="projectnumber">&#160;v1.0.0</span>
   </div>
   <div id="projectbrief">鸿雁战队RoboMaster</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','搜索');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('code_guide_style.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">代码规范</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>目录</h3>
<ul><li class="level1"><a href="#autotoc_md24">1 命名规范</a><ul><li class="level2"><a href="#autotoc_md25">1.1 文件命名</a></li>
<li class="level2"><a href="#autotoc_md26">1.2 函数命名</a></li>
<li class="level2"><a href="#autotoc_md27">1.3 变量命名</a></li>
<li class="level2"><a href="#autotoc_md28">1.4 结构体命名</a></li>
<li class="level2"><a href="#autotoc_md29">1.5 宏</a></li>
<li class="level2"><a href="#autotoc_md30">1.6 枚举量</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md32">2 书写规范</a></li>
<li class="level1"><a href="#autotoc_md33">3 一些建议</a><ul><li class="level2"><a href="#autotoc_md34">3.1 常用类型定义</a></li>
<li class="level2"><a href="#autotoc_md35">3.2 禁止申请动态内存</a></li>
<li class="level2"><a href="#autotoc_md36">3.3 禁止使用goto</a></li>
<li class="level2"><a href="#autotoc_md37">3.4 禁止嵌套三层以上</a></li>
<li class="level2"><a href="#autotoc_md38">3.5 可读性</a></li>
<li class="level2"><a href="#autotoc_md39">3.6 尽量解耦</a></li>
<li class="level2"><a href="#autotoc_md40">3.7 注释</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md41">总结</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="autotoc_md24"></a>
1 命名规范</h1>
<h2><a class="anchor" id="autotoc_md25"></a>
1.1 文件命名</h2>
<p>全拼小写，尽量不使用下划线。 例如<code>can.c</code>/<code><a class="el" href="gpio_8c.html" title="This file provides code for the configuration of all used GPIO pins.">gpio.c</a></code>。 <br  />
 如果是一个库中的文件，则为了标识库，可以在开头加上库名称的缩写，例如 </p><blockquote class="doxtable">
<p>&zwj;// OSLIB库中 <br  />
 <code>oslib_can.c</code> <br  />
 // SteerWheel库中 <br  />
 <code>sw_chassis.c</code> <br  />
 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md26"></a>
1.2 函数命名</h2>
<p>借鉴OOP思想，使用驼峰式命名（首字母大写）+下划线，利用下划线指明所属关系。 示例：假如函数在<code>paw.c</code>中</p>
<div class="fragment"><div class="line">Paw_SetCloseCurrent();</div>
<div class="line">Paw_GetGPIOState();</div>
<div class="line">Paw_SetSwitchState_Switch1();</div>
<div class="line">Paw_SetSwitchState_Switch2();</div>
</div><!-- fragment --><p>从函数名就可以看出这些函数属于<code>paw.c</code>，**set/get**指明函数功能，**Switch1、Switch2**指明子类型。 <br  />
</p><ul>
<li>如果文件名过长，可以使用首字母缩写，例如<code>catch_throw.c</code>可以缩写成*ct*。</li>
</ul>
<h2><a class="anchor" id="autotoc_md27"></a>
1.3 变量命名</h2>
<ul>
<li>==全局变量名==与函数名规则相同，例如在<code>catch_throw.c中</code>：</li>
</ul>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Paw_CloseCurrent = 0;           <span class="comment">// 手爪闭合电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Paw_OpenCurrent = 0;            <span class="comment">// 手爪张开电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Paw_ForwardRotateCurrent = 0;   <span class="comment">// 手爪正转电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Paw_ReverseRotateCurrent = 0;   <span class="comment">// 手爪倒转电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Belt_UpCurrent = 0;             <span class="comment">// 传送带往上转电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_Belt_DownCurrent = 0;           <span class="comment">// 传送带往下转电流</span></div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> CT_FrictionWhell_ServeCurrent = 0; <span class="comment">// 摩擦轮发球电流</span></div>
<div class="ttc" id="astruct__typedef_8h_html_a4611b605e45ab401f02cab15c5e38715"><div class="ttname"><a href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a></div><div class="ttdeci">float float32_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00017">struct_typedef.h:17</a></div></div>
</div><!-- fragment --><ul>
<li>==局部变量名==由于不需要指明所属关系，直接使用小写+下划线的形式即可，例如： <div class="fragment"><div class="line">uint8_t time_cnt_5ms_flag=1; </div>
</div><!-- fragment --></li>
<li>类似<code>CT_Paw_Rotate_Mode_Flag</code>的变量名是**不合适**的，因为**Rotate Mode**是一个完整的功能描述，并不存在从属关系，不应使用下划线，合理的命名方式应该是<code>CT_Paw_RotateMode_Flag</code>。</li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
1.4 结构体命名</h2>
<p>使用驼峰式命名（首字母大写），不允许有下划线，在结构体名的后面加上<code>_s</code>(struct)。例如</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>CanMsg_s{…};</div>
<div class="line"><span class="keyword">struct </span>ChassisData_s{…};</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span></div>
<div class="line">{</div>
<div class="line">    ...</div>
<div class="line">} ChassisData_s; <span class="comment">// 结构体声明</span></div>
<div class="line">ChassisData_s ChassisData; <span class="comment">// 全局变量</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md29"></a>
1.5 宏</h2>
<p>使用全大写+下划线格式，宏函数需要在开头追加两个下划线以区分。 <br  />
 例如：</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define TRUE 1</span></div>
<div class="line"><span class="preprocessor">#define RUN_FLAG 1</span></div>
<div class="line"><span class="preprocessor">#define __MAX(a,b) ((a)&gt;(b)?(a):(b))</span></div>
</div><!-- fragment --><p> <code>#ifdef</code>等条件编译请顶格，且在<code>#endif</code>之后写上一个注释，注明这个<code>#ifdef</code>块对应的内容： </p><div class="fragment"><div class="line"><span class="preprocessor">#ifdef CONFIG_SOMETHING</span></div>
<div class="line">...</div>
<div class="line">#endif <span class="comment">/* CONFIG_SOMETHING */</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md30"></a>
1.6 枚举量</h2>
<p>为了避免ENUM值在全局空间内冲突，ENUM的成员需要添加功能缩写前缀以表示命名空间。</p>
<p>枚举体别名使用驼峰命名法（首字母大写），末尾追加<code>_e</code>(enum)，例如：</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> </div>
<div class="line">{</div>
<div class="line">    DRIVE_MODE_CURRENT=0,</div>
<div class="line">    DRIVE_MODE_VOLTAGE,</div>
<div class="line">    DRIVE_MODE_SPEED,</div>
<div class="line">} DriveMode_e; <span class="comment">// 枚举量声明</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> target_current;</div>
<div class="line">    <a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> target_voltage;</div>
<div class="line">    <a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a> target_speed;</div>
<div class="line">    DriveMode_e drive_mode;</div>
<div class="line">}MotorDriver_s; <span class="comment">// 包含了枚举量的结构体</span></div>
<div class="line"> </div>
<div class="line">MotorDriver_s DJI_MotorDriver[4];<span class="comment">// 全局结构体变量</span></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md32"></a>
2 书写规范</h1>
<ul>
<li><p class="startli">函数尽量添加注释，使用==doxygen==注释风格，示例如下： </p><div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment">* @brief 函数简介</span></div>
<div class="line"><span class="comment">* @param a 形参a的意义</span></div>
<div class="line"><span class="comment">* @param b 形参b的意义</span></div>
<div class="line"><span class="comment">* @return 返回值说明</span></div>
<div class="line"><span class="comment">* @note 其他说明</span></div>
<div class="line"><span class="comment">**/</span></div>
<div class="line"><span class="keywordtype">int</span> MyFunction(<span class="keywordtype">int</span> a, <span class="keywordtype">int</span> b);</div>
</div><!-- fragment --><p class="startli">可以在VS Code中安装插件<code>Doxygen Documentation Generator</code>，代码中键入<code>/**</code>后按回车就可以自动生成函数注释。 <br  />
</p>
</li>
<li>对于<code>if</code>、<code>while</code>等语句，即使内容只有一行，也需要使用花括号<code>{}</code>包含。</li>
<li>花括号<code>{}</code>的左括号和右括号要垂直对齐。</li>
<li>尽量对每一行可能造成队友困惑的代码添加注释，说明其作用或运行逻辑。</li>
<li>请使用<code>UTF-8</code>编码，避免乱码的现象发生。</li>
<li>使用VS Code时可以按<code>alt+shift+f</code>格式化代码，使其看起来更整洁。</li>
<li>TAB请设置成4个字符，且让IDE用空格替代缩进符</li>
</ul>
<h1><a class="anchor" id="autotoc_md33"></a>
3 一些建议</h1>
<blockquote class="doxtable">
<p>&zwj;其实上面的是机器人队往年流传的规范，变量类型我稍微改了改 <br  />
 命名规范其实只是代码规范的一小部分，规范应当包含开发思想等内容，下面是一些额外的补充 <br  />
 可参考<a class="el" href="c_guide_style.html">C语言规范</a> </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md34"></a>
3.1 常用类型定义</h2>
<p>请不要用<code>float</code>，<code>int</code>，<code>DWORD</code>等作为变量类型，这无法知道变量大小，在编写通信协议和优化程序大小时非常不方便，且在不同编译器下可能的变量大小不一致。请<code>#include "struct_typedef.h"</code>，其中包含了类型的定义 <br  />
 </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef STRUCT_TYPEDEF_H</span></div>
<div class="line"><span class="preprocessor">#define STRUCT_TYPEDEF_H</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span> <a class="code hl_typedef" href="struct__typedef_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="struct__typedef_8h.html#aa5ad9bec438b7cf669efb1ca064e79f5">int16_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="struct__typedef_8h.html#ab1967d8591af1a4e48c37fd2b0f184d0">int32_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code hl_typedef" href="struct__typedef_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* exact-width unsigned integer types */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code hl_typedef" href="struct__typedef_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="struct__typedef_8h.html#adf4d876453337156dde61095e1f20223">uint16_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code hl_typedef" href="struct__typedef_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <a class="code hl_typedef" href="struct__typedef_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code hl_typedef" href="struct__typedef_8h.html#a449976458a084f880dc8e3d29e7eb6f5">bool_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">float</span> <a class="code hl_typedef" href="struct__typedef_8h.html#a4611b605e45ab401f02cab15c5e38715">float32_t</a>;</div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> <a class="code hl_typedef" href="struct__typedef_8h.html#ac55f3ae81b5bc9053760baacf57e47f4">float64_t</a>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="astruct__typedef_8h_html_a435d1572bf3f880d55459d9805097f62"><div class="ttname"><a href="struct__typedef_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></div><div class="ttdeci">unsigned int uint32_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00014">struct_typedef.h:14</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_a449976458a084f880dc8e3d29e7eb6f5"><div class="ttname"><a href="struct__typedef_8h.html#a449976458a084f880dc8e3d29e7eb6f5">bool_t</a></div><div class="ttdeci">unsigned char bool_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00016">struct_typedef.h:16</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_aa5ad9bec438b7cf669efb1ca064e79f5"><div class="ttname"><a href="struct__typedef_8h.html#aa5ad9bec438b7cf669efb1ca064e79f5">int16_t</a></div><div class="ttdeci">signed short int int16_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00007">struct_typedef.h:7</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_aaa5d1cd013383c889537491c3cfd9aad"><div class="ttname"><a href="struct__typedef_8h.html#aaa5d1cd013383c889537491c3cfd9aad">uint64_t</a></div><div class="ttdeci">unsigned long long uint64_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00015">struct_typedef.h:15</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_ab1967d8591af1a4e48c37fd2b0f184d0"><div class="ttname"><a href="struct__typedef_8h.html#ab1967d8591af1a4e48c37fd2b0f184d0">int32_t</a></div><div class="ttdeci">signed int int32_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00008">struct_typedef.h:8</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_aba7bc1797add20fe3efdf37ced1182c5"><div class="ttname"><a href="struct__typedef_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></div><div class="ttdeci">unsigned char uint8_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00012">struct_typedef.h:12</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_ac55f3ae81b5bc9053760baacf57e47f4"><div class="ttname"><a href="struct__typedef_8h.html#ac55f3ae81b5bc9053760baacf57e47f4">float64_t</a></div><div class="ttdeci">double float64_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00018">struct_typedef.h:18</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_adec1df1b8b51cb32b77e5b86fff46471"><div class="ttname"><a href="struct__typedef_8h.html#adec1df1b8b51cb32b77e5b86fff46471">int64_t</a></div><div class="ttdeci">signed long long int64_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00009">struct_typedef.h:9</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_adf4d876453337156dde61095e1f20223"><div class="ttname"><a href="struct__typedef_8h.html#adf4d876453337156dde61095e1f20223">uint16_t</a></div><div class="ttdeci">unsigned short int uint16_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00013">struct_typedef.h:13</a></div></div>
<div class="ttc" id="astruct__typedef_8h_html_aef44329758059c91c76d334e8fc09700"><div class="ttname"><a href="struct__typedef_8h.html#aef44329758059c91c76d334e8fc09700">int8_t</a></div><div class="ttdeci">signed char int8_t</div><div class="ttdef"><b>Definition</b> <a href="struct__typedef_8h_source.html#l00006">struct_typedef.h:6</a></div></div>
</div><!-- fragment --><p> <br  />
 请测试不同编译器情况下类型大小定义是否正确。 <br  />
 其中关于大小要注意<code>sizeof</code>的大小，sizeof(枚举类型)在不同编译器下大小不一致，有可能是4字节，也有可能是1字节。在编写通信协议时记得让结构体内存对齐，用<code>PACKED</code>宏定义</p>
<h2><a class="anchor" id="autotoc_md35"></a>
3.2 禁止申请动态内存</h2>
<p><b>禁止使用malloc、free、calloc等类似操作。</b> <br  />
 单片机内存空间很小，且由于开发特性，其实完全不需要malloc动态申请内存空间，反倒malloc后由于人为失误忘记free，或由于if-else等控制流编写错误导致free两次，令程序堆溢出或其他错误。这对程序是致命的，在日常情况下，由于测试情况不够广泛，导致仅当某些小概率情况会产生错误。 <br  />
</p>
<p>所以在所有情况下都应当先定义好内存空间，例如数组等操作，这样能令单片机的内存空间大小得到很好的管理。 <br  />
 其次是缓冲区溢出问题，尽量减少使用<code>sprintf</code>，<code>sscanf</code>等函数，可用其他方法替代，例如sscanf替换成自定义解析协议。</p>
<h2><a class="anchor" id="autotoc_md36"></a>
3.3 禁止使用goto</h2>
<p>不可否认的是某些情况下使用goto是好的，但大多数情况下goto会令代码控制流不清晰，且实际不存在必须使用goto的情况。在水平参差不齐的本科团队中，goto非常不利于管理及调试。所以如有用goto的情况，请重构代码。</p>
<h2><a class="anchor" id="autotoc_md37"></a>
3.4 禁止嵌套三层以上</h2>
<p>嵌套三层以上if-else语句会令代码可读性大幅下降，需要注意的是条件编译的<code>#ifdef</code>或<code>#if</code>也算在其中，下面是个真实的例子 </p><div class="fragment"><div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="struct__typedef_8h.html#adf4d876453337156dde61095e1f20223">uint16_t</a> <a class="code hl_variable" href="example__nested__ifdef_8c.html#ab66f462f021d7ad43c729c9684a5408c">key_press_cnt</a> = 0;</div>
<div class="line"><span class="preprocessor">#define USE_KEY 1</span></div>
<div class="line"><span class="preprocessor">#define DEBOUNCING 1</span></div>
<div class="line"><span class="preprocessor">#define DEBOUCING_PRESS_CNT 1000</span></div>
<div class="line"><span class="preprocessor">#define USE_INTERRUPT 1</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span> (1)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if USE_INTERRUPT == 0</span></div>
<div class="line"><span class="preprocessor">#if USE_KEY</span></div>
<div class="line">    <a class="code hl_typedef" href="struct__typedef_8h.html#aba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> key;</div>
<div class="line"><span class="preprocessor">#if DEBOUNCING</span></div>
<div class="line">    <a class="code hl_variable" href="example__nested__ifdef_8c.html#ab66f462f021d7ad43c729c9684a5408c">key_press_cnt</a> = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(HAL_GPIO_ReadPin(KEY_GPIO_Port,KEY_Pin) == 0)</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_variable" href="example__nested__ifdef_8c.html#ab66f462f021d7ad43c729c9684a5408c">key_press_cnt</a>++;</div>
<div class="line">    }</div>
<div class="line">    key = <a class="code hl_variable" href="example__nested__ifdef_8c.html#ab66f462f021d7ad43c729c9684a5408c">key_press_cnt</a> &lt; <a class="code hl_define" href="example__nested__ifdef_8c.html#a38a93f49ccb0fa8e198d62aee27ce70e">DEBOUCING_PRESS_CNT</a>;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    key = HAL_GPIO_ReadPin(KEY_GPIO_Port,KEY_Pin);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">    <span class="keywordflow">if</span>(key == 0)</div>
<div class="line">    {</div>
<div class="line">        state = ~state &amp; 0x1;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    state = ~state &amp; 0x1;</div>
<div class="line">    HAL_Delay(100);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#endif  </span></div>
<div class="line">    HAL_GPIO_WritePin(LED1_GPIO_Port,LED1_Pin,state);</div>
<div class="line">    HAL_Delay(1);</div>
<div class="line">}</div>
<div class="ttc" id="aexample__nested__ifdef_8c_html_a38a93f49ccb0fa8e198d62aee27ce70e"><div class="ttname"><a href="example__nested__ifdef_8c.html#a38a93f49ccb0fa8e198d62aee27ce70e">DEBOUCING_PRESS_CNT</a></div><div class="ttdeci">#define DEBOUCING_PRESS_CNT</div><div class="ttdef"><b>Definition</b> <a href="example__nested__ifdef_8c_source.html#l00005">example_nested_ifdef.c:5</a></div></div>
<div class="ttc" id="aexample__nested__ifdef_8c_html_ab66f462f021d7ad43c729c9684a5408c"><div class="ttname"><a href="example__nested__ifdef_8c.html#ab66f462f021d7ad43c729c9684a5408c">key_press_cnt</a></div><div class="ttdeci">uint16_t key_press_cnt</div><div class="ttdef"><b>Definition</b> <a href="example__nested__ifdef_8c_source.html#l00002">example_nested_ifdef.c:2</a></div></div>
</div><!-- fragment --><p> 可见虽然实现了效果，但可读性十分之低，使用条件编译时应当尽量只有一层嵌套，将多层嵌套换成一层。 </p><blockquote class="doxtable">
<p>&zwj;函数的代码块嵌套深度指的是函数中的代码控制块（例如：if、for、while、switch等）之间互相包含的深度。每级嵌套都会增加阅读代码时的脑力消耗，因为需要在脑子里维护一个“栈”（比如，进入条件语句、进入循环„„）。应该做进一步的功能分解，从而避免使代码的阅读者一次记住太多的上下文。 </p>
</blockquote>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="example__nested_8c.html#a44becc30285e88213a624428b2b46cdf">serial</a> (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">if</span> (!Received)</div>
<div class="line">   {</div>
<div class="line">      TmoCount = 0;</div>
<div class="line">      <span class="keywordflow">switch</span> (Buff)</div>
<div class="line">      {</div>
<div class="line">         <span class="keywordflow">case</span> AISGFLG:</div>
<div class="line">            <span class="keywordflow">if</span> ((TiBuff.Count &gt; 3)</div>
<div class="line">            &amp;&amp; ((TiBuff.Buff[0] == 0xff) || (TiBuf.Buff[0] == CurPa.ADDR)))</div>
<div class="line">            {<span class="comment">//串口收到的数据 符合校验规则</span></div>
<div class="line">               Flg7E = <span class="keyword">false</span>;</div>
<div class="line">               Received = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">            {</div>
<div class="line">               TiBuff.Count = 0;</div>
<div class="line">               Flg7D = <span class="keyword">false</span>;</div>
<div class="line">               Flg7E = <span class="keyword">true</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">         <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="ttc" id="aexample__nested_8c_html_a44becc30285e88213a624428b2b46cdf"><div class="ttname"><a href="example__nested_8c.html#a44becc30285e88213a624428b2b46cdf">serial</a></div><div class="ttdeci">void serial(void)</div><div class="ttdef"><b>Definition</b> <a href="example__nested_8c_source.html#l00001">example_nested.c:1</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md38"></a>
3.5 可读性</h2>
<blockquote class="doxtable">
<p>&zwj;“程序必须为阅读它的人而编写，只是顺便用于机器执行。” <br  />
 ——Harold Abelson 和 Gerald Jay Sussman <br  />
 “编写程序应该以人为本，计算机第二。” <br  />
 ——Steve McConnell </p>
</blockquote>
<p>这部分详细请看<a class="el" href="c_guide_style.html#c_style_format">排版与格式</a>，其中部分已在<code>2 书写规范</code>提过。</p>
<h2><a class="anchor" id="autotoc_md39"></a>
3.6 尽量解耦</h2>
<p>例如在开发BMI088芯片（6轴传感器）的驱动，参考RM官步的<code>BMI088driver.c</code>，<code>BMI088driver.h</code>，<code>BMI088Middleware.c</code> <br  />
 <img src="image/2023-10-25-00-53-00.png" alt="" class="inline"/> <br  />
 在编写驱动时将读写字节，CS拉高拉低操作的函数添加到一个新的文件内进行编写，这大大增加了可移植性，将实现解耦，且内部函数用了static定义。 <br  />
</p>
<blockquote class="doxtable">
<p>&zwj;作者注：RM官步代码在规范上尚未做好，例如文件的命名没有统一格式，例如<code>BMI088Middleware.c</code>和<code>ist8310driver_middleware.c</code>，且某些功能实现上可读性稍差，特别是云台和底盘的部分。 <br  />
 我个人不建议将一些基础驱动例如SPI或GPIO新增一个Middleware文件，应当在驱动实现的头文件添加定义方便移植。若头文件较大可新增一个头文件专门定义驱动相关的实现。 <br  />
 其实这RM的实现方法没有问题，我个人感观在代码量少的情况下，代码量不变，文件越多反倒降低了可读性，因为需要来回查找文件。 </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md40"></a>
3.7 注释</h2>
<blockquote class="doxtable">
<p>&zwj;有注释当然是好的，但是注释太多就很恶心了。千万不要在注释里面解释你的程序怎么运行的。相对于尝试用注释解释清楚你那恶心的代码，你还不如就写个清晰易懂（译者注：就是小而精，萌妹子一样单纯的~）的函数。 <br  />
 摘自 Linux内核C编程规范 </p>
</blockquote>
<p>这部分详细请看<a class="el" href="c_guide_style.html#c_style_comment">C语言规范-注释</a>，其中要注意的是 <br  />
 </p><blockquote class="doxtable">
<p>&zwj;在代码的功能、意图层次上进行注释，即注释解释代码难以直接表达的意图，而不是重复描述代码。 </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md41"></a>
总结</h1>
<p>在写代码的过程中一直在考虑规范性问题有时候也挺讨厌的，但代码规范确实有利于队伍传承，所以队公共库还是尽量按规范。对于北邮目前的情况而言，Robomaster超级对抗赛，其实实际一台机器人也就一个电控组队员实现。传承什么的，还是别考虑了，有时还是自私一点好，自身学到知识了就行。 </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">生成于 2023年 十月 25日 星期三 02:35:49 , 为 电控组文档使用  <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
